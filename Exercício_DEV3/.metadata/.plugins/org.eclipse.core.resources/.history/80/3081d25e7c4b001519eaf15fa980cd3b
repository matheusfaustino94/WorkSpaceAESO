package br.aeso.ex01Maurício.exercício.controlador;

import java.util.ArrayList;

import br.aeso.ex01Maurício.exercício.exceptions.projetoException;
import br.aeso.ex01Maurício.exercício.modelo.Endereço;
import br.aeso.ex01Maurício.exercício.modelo.Fornecedor;
import br.aeso.ex01Maurício.exercício.repositorio.GenericRepositorioList;
import br.aeso.ex01Maurício.exercício.repositorio.IRepositorio;
import br.aeso.ex01Maurício.exercício.util.ValidarCPF;

public class ControladorFornecedor implements IControlador<Fornecedor> {

	IRepositorio<Fornecedor> repositorioFornecedor;
	IControlador<Endereço> controladorEndereco;

	public ControladorFornecedor() {
		repositorioFornecedor = new GenericRepositorioList<>();
		controladorEndereco = new ControladorEndereco();
	}

	public void cadastrarEntities(Fornecedor fornecedor)
			throws projetoException {

		if ((fornecedor != null) && (ValidarCPF.validaCPF(fornecedor.getCpf()))) {
			if (fornecedor.getNome().equals("")) {
				throw new projetoException("Nome inválido!");
			} else {
				repositorioFornecedor.cadastrar(fornecedor);
				controladorEndereco.cadastrarEntities(fornecedor.getEndereço());
			}
		} else {
			throw new projetoException("Fornecedor ou CPF inválido!");
		}
	}

	public void atualizarEntities(Fornecedor fornecedor)
			throws projetoException {

		if ((fornecedor != null) && (ValidarCPF.validaCPF(fornecedor.getCpf()))) {
			if (fornecedor.getNome() == "" || fornecedor.getCpf() == "") {
				throw new projetoException("Fornecedor inválido!");
			} else {
				repositorioFornecedor.atualizar(fornecedor);
				controladorEndereco.atualizarEntities(fornecedor.getEndereço());
			}
		} else {
			throw new projetoException("Fornecedor ou CPF inválido!");
		}

	}

	public boolean removerEntities(String cpf) throws projetoException {
		Integer idFornecedor = procurarID(cpf);
		controladorEndereco.removerEntities(cpf);
		return repositorioFornecedor.remover(idFornecedor);
	}

	public Fornecedor procurarEntities(String cpf) throws projetoException {
		Integer idFornecedor = procurarID(cpf);
		return repositorioFornecedor.procurar(idFornecedor);
	}

	public ArrayList<Fornecedor> listarEntities() throws projetoException {
		return repositorioFornecedor.listarEntities();
	}

	private Integer procurarID(String cpf) throws projetoException {
		ArrayList<Fornecedor> fornecedores = listarEntities();
		if (fornecedores.isEmpty()) {
			return null;
		} else {
			for (Fornecedor f : fornecedores) {
				if (f.getCpf().equals(cpf)) {
					return f.getID();
				}
			}
		}
		return null;
	}
}